{% doc %}
  @prompt
    I need a product page block. It should be a small horizontal info bar placed under the product CTA on the product page.
    
    What the block should include:
    
    A small inline truck icon on the left (SVG is fine)
    
    Text next to the icon in this format:
    “SAŅEM PASŪTĪJUMU: 23.–29. OKTOBRIS”
    
    The date range must be editable in the theme editor
    
    Background color is a light pink (#FDEFEF)
    
    The block has rounded corners and padding (exact like the example)
    
    Text should be uppercase, with the “date range” part bolded
    
    Should fit naturally within the product information column (not full width)
    
    Should be created as a product information block so it can be added inside main-product.liquid or the theme’s product page blocks
    
    Customization options in the schema:
    
    Date range text
    
    Background color
    
    Text color
    
    Optional: icon change (upload or SVG picker)
    
    Please generate the Liquid block code + schema JSON so I can add it as a product block in the PDP., date range should be customizable like it should be generated by javascript for example that the product will be shipped in 10 days in thie duration of x days i should be able to customize that and it should be full width, add an option that i can align it, left right and center
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-delivery-info-wrapper-{{ ai_gen_id }} {
    display: flex;
    {% if block.settings.alignment == 'left' %}
      justify-content: flex-start;
    {% elsif block.settings.alignment == 'center' %}
      justify-content: center;
    {% elsif block.settings.alignment == 'right' %}
      justify-content: flex-end;
    {% endif %}
  }

  .ai-delivery-info-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 10px;
    background-color: {{ block.settings.background_color }};
    padding: 12px 16px;
    border-radius: {{ block.settings.border_radius }}px;
    width: 100%;
  }

  .ai-delivery-info-icon-{{ ai_gen_id }} {
    flex-shrink: 0;
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-delivery-info-icon-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    fill: none;
    stroke: {{ block.settings.icon_color }};
    stroke-width: 1.5;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .ai-delivery-info-icon-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .ai-delivery-info-text-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    line-height: 1.4;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .ai-delivery-info-label-{{ ai_gen_id }} {
    font-weight: 400;
  }

  .ai-delivery-info-dates-{{ ai_gen_id }} {
    font-weight: 700;
  }

  @media screen and (max-width: 749px) {
    .ai-delivery-info-{{ ai_gen_id }} {
      padding: 10px 14px;
      gap: 8px;
    }

    .ai-delivery-info-text-{{ ai_gen_id }} {
      font-size: {{ block.settings.text_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<div class="ai-delivery-info-wrapper-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <delivery-info-{{ ai_gen_id }}
    class="ai-delivery-info-{{ ai_gen_id }}"
    data-start-days="{{ block.settings.start_days }}"
    data-end-days="{{ block.settings.end_days }}"
    data-date-format="{{ block.settings.date_format }}"
  >
    <div class="ai-delivery-info-icon-{{ ai_gen_id }}">
      {% if block.settings.custom_icon != blank %}
        <img
          src="{{ block.settings.custom_icon | image_url: width: 100 }}"
          alt="Delivery icon"
          loading="lazy"
          width="100"
          height="100"
        >
      {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M1 3h15v13H1z"></path>
          <path d="M16 8h3l3 3v5h-6V8z"></path>
          <circle cx="5.5" cy="18.5" r="2.5"></circle>
          <circle cx="18.5" cy="18.5" r="2.5"></circle>
        </svg>
      {% endif %}
    </div>
    <div class="ai-delivery-info-text-{{ ai_gen_id }}">
      <span class="ai-delivery-info-label-{{ ai_gen_id }}">{{ block.settings.delivery_label }}</span>
      <span class="ai-delivery-info-dates-{{ ai_gen_id }}"></span>
    </div>
  </delivery-info-{{ ai_gen_id }}>
</div>

<script>
  (function() {
    class DeliveryInfo{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.calculateDeliveryDates();
      }

      calculateDeliveryDates() {
        const startDays = parseInt(this.dataset.startDays) || 0;
        const endDays = parseInt(this.dataset.endDays) || 0;
        const dateFormat = this.dataset.dateFormat || 'short';

        const today = new Date();
        const startDate = new Date(today);
        startDate.setDate(today.getDate() + startDays);

        const endDate = new Date(today);
        endDate.setDate(today.getDate() + endDays);

        const formattedRange = this.formatDateRange(startDate, endDate, dateFormat);
        
        const datesElement = this.querySelector('.ai-delivery-info-dates-{{ ai_gen_id }}');
        if (datesElement) {
          datesElement.textContent = formattedRange;
        }
      }

      formatDateRange(startDate, endDate, format) {
        const locale = document.documentElement.lang || 'lv-LV';
        
        let options;
        if (format === 'long') {
          options = { day: 'numeric', month: 'long' };
        } else if (format === 'numeric') {
          options = { day: '2-digit', month: '2-digit' };
        } else {
          options = { day: 'numeric', month: 'short' };
        }

        const startFormatted = startDate.toLocaleDateString(locale, options);
        const endFormatted = endDate.toLocaleDateString(locale, options);

        if (startDate.getMonth() === endDate.getMonth()) {
          const startDay = startDate.getDate();
          const endDay = endDate.getDate();
          const month = endDate.toLocaleDateString(locale, { month: format === 'long' ? 'long' : 'short' });
          
          if (format === 'numeric') {
            return startFormatted + '–' + endFormatted;
          } else {
            return startDay + '.–' + endDay + '. ' + month.toUpperCase();
          }
        } else {
          return startFormatted + '–' + endFormatted;
        }
      }
    }

    customElements.define('delivery-info-{{ ai_gen_id }}', DeliveryInfo{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Delivery info bar",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "delivery_label",
      "label": "Delivery label",
      "default": "SAŅEM PASŪTĪJUMU:"
    },
    {
      "type": "header",
      "content": "Delivery timeframe"
    },
    {
      "type": "range",
      "id": "start_days",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "d",
      "label": "Start delivery (days from today)",
      "default": 7
    },
    {
      "type": "range",
      "id": "end_days",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "d",
      "label": "End delivery (days from today)",
      "default": 14
    },
    {
      "type": "select",
      "id": "date_format",
      "label": "Date format",
      "options": [
        {
          "value": "short",
          "label": "Short (23.–29. OKT)"
        },
        {
          "value": "long",
          "label": "Long (23.–29. October)"
        },
        {
          "value": "numeric",
          "label": "Numeric (23.10–29.10)"
        }
      ],
      "default": "short"
    },
    {
      "type": "header",
      "content": "Icon"
    },
    {
      "type": "image_picker",
      "id": "custom_icon",
      "label": "Custom icon",
      "info": "Leave empty to use default truck icon"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 20
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#FDEFEF"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 12
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Delivery info bar"
    }
  ]
}
{% endschema %}